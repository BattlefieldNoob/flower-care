# This file is generated by Nx.
#
# Build the docker image with `npx nx docker-build flower-care-rpi`.
# Tip: Modify "docker-build" options in project.json to change docker build args.
#
# Run the container with `docker run -p 3000:3000 -t flower-care-rpi`.


FROM oven/bun:latest as builder

WORKDIR /app/flower-care-rpi

COPY package.json ./

COPY bun.lockb ./

#RUN apt update && apt install -y build-essential libudev-dev python3-dev 

#RUN bun install --ignore-scripts

COPY /node_modules/@abandonware ./node_modules/@abandonware
COPY /node_modules/miflora ./node_modules/miflora
COPY /node_modules/debug ./node_modules/debug
COPY /node_modules/ms ./node_modules/ms

COPY dist/apps/flower-care-rpi ./
FROM oven/bun:slim 

WORKDIR /app

COPY --from=builder app/flower-care-rpi  flower-care-rpi

RUN addgroup --system flower-care-rpi && \
          useradd --system -g flower-care-rpi flower-care-rpi

RUN chown -R flower-care-rpi:flower-care-rpi .

CMD [ "bun", "flower-care-rpi/main.js" ]
